<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "c692a8975d7d5b99575a553de1c5e8a7",
  "translation_date": "2025-06-11T04:53:45+00:00",
  "source_file": "08-multi-agent/README.md",
  "language_code": "ja"
}
-->
<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "c692a8975d7d5b99575a553de1c5e8a7",
  "translation_date": "2025-08-26T00:00:00+00:00",
  "source_file": "08-multi-agent/README.md",
  "language_code": "ja",
  "translator": "human-reviewed"
}
-->
[![マルチエージェント デザイン](../../../08-multi-agent/images/lesson-8-thumbnail.png)](https://youtu.be/V6HpE9hZEx0?si=A7K44uMCqgvLQVCa)

> （上の画像をクリックすると本レッスンの動画に移動します）

# マルチエージェント デザインパターン

複数のエージェントを扱うプロジェクトを検討し始めると、「いつ単一エージェント構成から移行すべきか」「移行の利点は何か」を判断する必要が生じます。本レッスンではその判断軸と実装構成要素を整理します。

## はじめに

本レッスンで扱う主要な問い:

- どのようなシナリオでマルチエージェントが有効か
- 単一エージェントに比べた際の利点は何か
- 実装上の基本ブロック（構成要素）は何か
- 複数エージェント間の相互作用をどのように観測・可視化するか

## 学習ゴール

完了後にできること:

- マルチエージェント適用が合理的なシナリオを識別する
- 単一エージェント設計とのトレードオフと利点を説明できる
- マルチエージェント実装の構成要素を分解して理解する

全体像: *複数エージェントが共同で共有ゴール達成に向け協調する設計パターン* であり、ロボティクス / 自律システム / 分散コンピューティング等で広く用いられています。

## マルチエージェントが有効なシナリオ

代表的な適用領域:

- **大規模ワークロード**: 大きな仕事を独立した小タスクへ分解し並列化 → スループット向上（例: 大規模データ処理）
- **高い複雑性**: 専門領域ごとにタスクを委譲し判断経路を単純化（例: 自動運転: 経路計画 / 障害物検知 / 通信）
- **多様な専門性**: 一人の汎用エージェントより専門別最適化が精度・説明性を高める（例: 医療: 診断 / 治療計画 / モニタリング）

## 単一エージェントより優れる点

| 観点 | 単一 | 複数エージェント |
|------|------|------------------|
| 専門性 | 汎用化で迷走リスク | 専門タスクに最適化 |
| スケーラビリティ | モノリシック肥大 | 水平追加で拡張容易 |
| 障害耐性 | 単一点故障 | 部分劣化で継続可 |
| 保守性 | 依存密結合 | 機能境界明確化 |

旅行手配例: 単一エージェントにフライト/ホテル/レンタカー全ツールを抱かせると肥大化・変更困難。マルチ化で機能境界と責務が明確になり拡張性・保守性が改善します。

## 実装のビルディングブロック

旅行手配を題材に必要要素を整理:

- **エージェント間通信**: 共有すべきデータ（旅程日付・制約）と伝達チャネル（同期/非同期, ブローカー方式など）
- **調整メカニズム**: 依存タスクの順序制御・競合解決（例: ホテル確定前にフライト確保制約を考慮）
- **エージェント内部構造**: 意思決定ロジック / 学習 (埋め込み類似度, ルール, RLHF 等)
- **可視化・観測性**: ログ, トレース, メトリクス, 状態ダッシュボード
- **アーキテクチャパターン**: 集中型 / 分散型 / ハイブリッド
- **Human-in-the-loop**: 不確実性閾値 / 承認フロー / 例外エスカレーション設計

## 相互作用の可視化

可視化によりデバッグ・最適化・説明責任を担保:

- **ロギング/モニタリング**: アクション単位 (誰が / いつ / 何を / 結果)
- **可視化ツール**: 情報フローグラフ, 依存 DAG（Directed Acyclic Graph：有効非巡回グラフ）, タイムライン
- **パフォーマンス指標**: 平均遅延, スループット, 成功率, 再試行回数, コスト/実行比

## 代表的マルチエージェント パターン

### グループチャット (Group Chat)
複数エージェントが共有コンテキストで逐次メッセージ交換。ブレインストーミング / カスタマーサポート 等。

対応サンプル: [AutoGen グループチャット例 (日本語ノートブック)](./code_samples/08-autogen.ipynb) / [Semantic Kernel グループチャット例](./code_samples/08-semantic-kernel.ipynb)

![グループチャット構成図](../../../08-multi-agent/images/multi-agent-group-chat.png)

### ハンドオフ (Hand-off)
ワークフロー段階ごとに責務移譲。エスカレーション / 承認フロー / チケットライフサイクル。

対応サンプル: [出張手配 予約→保存 ハンドオフ例](./code_samples/08-python_multi_aiagent_bookinghotel.ipynb)

![ハンドオフ構成図](../../../08-multi-agent/images/multi-agent-hand-off.png)

### 協調フィルタリング / 合議 (Collaborative Filtering)
異種専門性 (業界知識 / テクニカル分析 / ファンダメンタル分析 など) を統合し推奨品質を向上。

（本レッスン付属ノートブックでは簡易例。高度な合議は Lesson 9 以降応用で拡張可能）

![協調フィルタリング構成図](../../../08-multi-agent/images/multi-agent-filtering.png)

## シナリオ例: 返金プロセス

プロセス固有エージェント: 顧客 / 販売者 / 支払い / 解決 / コンプライアンス など。

汎用エージェント: 物流, フィードバック, エスカレーション, 通知, 分析, 監査, レポート, ナレッジ, セキュリティ, 品質 等。

区別: 固有エージェントはドメイン制約に密接、汎用エージェントは再利用性と運用効率化を主眼に水平展開。

## 課題 (Assignment)

カスタマーサポートプロセス向けマルチエージェントシステムを設計し、エージェント種別 / 役割 / 相互作用 / HITL ポイントを列挙してください。

> 解答を見る前に、必要なエージェント数を自分で見積もってください。

## 解答

[Solution](./solution/solution.md)

## ナレッジチェック

質問: どのタイミングでマルチエージェント活用を検討すべきか?

- [ ] A1: 低ボリュームで単純なタスクのみのとき
- [ ] A2: 大きなワークロードがあり並列化/専門化利得が見込めるとき
- [ ] A3: 単純で状態遷移がほぼ無いタスクのみのとき

[Solution quiz](./solution/solution-quiz.md)

## まとめ

本レッスンでは、(1) 適用シナリオ、(2) 単一構成との差異と利点、(3) 実装ビルディングブロック、(4) 観測性確保、(5) 代表パターン (グループチャット / ハンドオフ / 協調) を整理しました。次段としてはルーティング戦略選定 (ルール vs 意味的類似度) や再計画トリガー設計、コスト/遅延/品質トレードオフのメトリクス化が焦点になります。

## 追加リソース

- <a href="https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/design-patterns/intro.html" target="_blank">AutoGen デザインパターン</a>
- <a href="https://www.analyticsvidhya.com/blog/2024/10/agentic-design-patterns/" target="_blank">エージェント型デザインパターン概説</a>

## 前のレッスン

[プランニング デザイン](../07-planning-design/README.md)

## 次のレッスン

[AIエージェントにおけるメタ認知](../09-metacognition/README.md)

---
**免責事項**: 本ドキュメントは原文を基に人による確認を加えた翻訳です。正確性が厳密に要求される用途では原文を参照してください。